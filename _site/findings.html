<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Ken Lin &amp; Team">
<meta name="dcterms.date" content="2026-02-23">

<title>Findings, Results &amp; Discussion ‚Äì FinRetain App</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-597958c53c93a607afca12fd375c57ed.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-7c8793e99a21e081e2bb8d69993efb75.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">FinRetain App</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./ui_design.html"> 
<span class="menu-text">UI/UX Design</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./storyboard.html"> 
<span class="menu-text">Storyboard</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./proposal.html"> 
<span class="menu-text">Proposal</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./meeting.html"> 
<span class="menu-text">Minutes of Meeting</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-methodology" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Methodology</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-methodology">    
        <li>
    <a class="dropdown-item" href="./data_prep.html">
 <span class="dropdown-text">Data Preparation</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./analysis.html">
 <span class="dropdown-text">Exploratory Analysis</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link active" href="./findings.html" aria-current="page"> 
<span class="menu-text">Findings &amp; Discussion</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./poster.html"> 
<span class="menu-text">Poster</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./user-guide.html"> 
<span class="menu-text">User Guide</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/kenlim0620/ISSS608-Team-15-Project"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://lin-xianwei.shinyapps.io/New-Shiny/"> 
<span class="menu-text">Launch App üöÄ</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul class="collapse">
  <li><a href="#executive-summary" id="toc-executive-summary" class="nav-link active" data-scroll-target="#executive-summary">Executive Summary</a>
  <ul class="collapse">
  <li><a href="#the-engagement-friction-point-eda-cda-results" id="toc-the-engagement-friction-point-eda-cda-results" class="nav-link" data-scroll-target="#the-engagement-friction-point-eda-cda-results">1. The Engagement Friction Point (EDA &amp; CDA Results)</a></li>
  <li><a href="#algorithmic-and-rule-based-personas-and-value-satisfaction-segmentation" id="toc-algorithmic-and-rule-based-personas-and-value-satisfaction-segmentation" class="nav-link" data-scroll-target="#algorithmic-and-rule-based-personas-and-value-satisfaction-segmentation">2. Algorithmic and Rule-Based Personas and Value Satisfaction (Segmentation)</a></li>
  <li><a href="#the-churn-timeline-and-capital-bleed" id="toc-the-churn-timeline-and-capital-bleed" class="nav-link" data-scroll-target="#the-churn-timeline-and-capital-bleed">3. The Churn Timeline and Capital Bleed</a></li>
  <li><a href="#macro-ecosystem-cash-flow-sankey" id="toc-macro-ecosystem-cash-flow-sankey" class="nav-link" data-scroll-target="#macro-ecosystem-cash-flow-sankey">4. Macro Ecosystem: Cash Flow Sankey</a></li>
  <li><a href="#proactive-intervention-predictive-modelling" id="toc-proactive-intervention-predictive-modelling" class="nav-link" data-scroll-target="#proactive-intervention-predictive-modelling">5. Proactive Intervention (Predictive Modelling)</a></li>
  <li><a href="#strategic-discussions-recommendations" id="toc-strategic-discussions-recommendations" class="nav-link" data-scroll-target="#strategic-discussions-recommendations">6. Strategic Discussions &amp; Recommendations</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">7. Conclusion</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Findings, Results &amp; Discussion</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Ken Lin &amp; Team </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">February 23, 2026</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="executive-summary" class="level1">
<h1>Executive Summary</h1>
<p>The <strong>FinRetain</strong> visual analytics project set out to democratize complex transactional data and uncover the hidden drivers of customer churn. Through a rigorous pipeline of Exploratory Data Analysis, Algorithmic Clustering, Macro-Ecosystem Mapping, and Predictive Modelling, we have transitioned our understanding of the user base from reactive observation to proactive forecasting. Below are the synthesized findings and strategic business recommendations derived from our interactive dashboard.</p>
<hr>
<section id="the-engagement-friction-point-eda-cda-results" class="level2">
<h2 class="anchored" data-anchor-id="the-engagement-friction-point-eda-cda-results">1. The Engagement Friction Point (EDA &amp; CDA Results)</h2>
<p>Our initial hypothesis assumed that users with the highest transaction volumes would inherently possess the highest satisfaction scores. Our Confirmatory Data Analysis (CDA) proved this false.</p>
<ul>
<li><strong>Volume Distribution:</strong> The transaction breakdown indicates that Direct Deposits are the primary driver of incoming liquidity, while Payments (rather than Cash Withdrawals) constitute the highest volume of outgoing capital.</li>
<li><strong>Income vs.&nbsp;App Engagement:</strong> Customers in the ‚ÄúHigh‚Äù and ‚ÄúVery High‚Äù income brackets exhibit significantly higher transaction frequencies. However, they are also highly sensitive to friction, showing a steep drop in Satisfaction Score when their <code>support_tickets_count</code> increases.</li>
<li><strong>The Finding:</strong> While high-income and highly educated users transact more frequently, their satisfaction scores exhibit high variance. By mapping <code>support_tickets_count</code> onto our scatter plots, a clear negative correlation emerged.</li>
<li><strong>The Insight:</strong> The FinRetain App‚Äôs core UX is functional, but our customer support pipeline is a severe bottleneck. High-value users lose faith in the platform the moment they encounter a dispute that requires a support ticket.</li>
<li><strong>Actionable Step:</strong> Implement automated, AI-driven ticket resolution for ‚ÄúHigh-Value‚Äù users to reduce friction and protect satisfaction scores.</li>
</ul>
<hr>
</section>
<section id="algorithmic-and-rule-based-personas-and-value-satisfaction-segmentation" class="level2">
<h2 class="anchored" data-anchor-id="algorithmic-and-rule-based-personas-and-value-satisfaction-segmentation">2. Algorithmic and Rule-Based Personas and Value Satisfaction (Segmentation)</h2>
<p>Manual demographic filtering is insufficient for modern FinTech marketing. We deployed both K-Means clustering and RFM (Recency, Frequency, Monetary) analysis to segment our users. Rather than relying solely on demographic assumptions, we deployed algorithmic clustering to find hidden behavioral patterns, and the dynamic RFM (Recency, Frequency, Monetary) Treemap allowed us to instantly categorize our entire database into actionable blocks:</p>
<ul>
<li><p><strong>Three Personas:</strong> By running K-Means on <code>tx_count</code> and <code>total_tx_volume</code>, the algorithm autonomously grouped our users into three distinct personas. It highlighted a massive ‚Äúmiddle-class‚Äù of users who log in and transact frequently, but move very little actual monetary value.</p></li>
<li><p><strong>K-Means Findings:</strong> The algorithm naturally grouped our users into three distinct behavioral personas based purely on transaction frequency and monetary volume. We identified a massive ‚Äúmiddle-class‚Äù of users who transact frequently but with very low monetary value.</p></li>
<li><p><strong>Champions &amp; Loyalists:</strong> While making up a smaller physical percentage of the user base, the dark color mapping (indicating high Customer Lifetime Value) confirmed that this group drives the vast majority of future projected revenue.</p></li>
<li><p><strong>At-Risk Segments:</strong> A surprisingly large block of users fell into the ‚ÄúRecent Users‚Äù category with dangerously low Frequency scores. These users are at immediate risk of churning if not engaged quickly.</p></li>
<li><p><strong>RFM Findings:</strong> Our interactive Treemap revealed that while we have a solid block of ‚ÄúChampions‚Äù (High R, F, and M scores), an alarming percentage of users fall into the ‚ÄúRecent but Low Frequency‚Äù block.</p></li>
<li><p><strong>Actionable Step:</strong> Gamify the daily app experience (e.g., daily login rewards, micro-investing features) specifically targeted at the low-frequency segments identified in the Treemap to convert them into Champions.</p></li>
</ul>
<hr>
</section>
<section id="the-churn-timeline-and-capital-bleed" class="level2">
<h2 class="anchored" data-anchor-id="the-churn-timeline-and-capital-bleed">3. The Churn Timeline and Capital Bleed</h2>
<p>Understanding <em>who</em> leaves is only half the battle; we needed to know <em>when</em> they leave and <em>where</em> the money goes. Using the Kaplan-Meier Churn Probability Curve, we plotted the exact tenure months where different customer segments are statistically most likely to abandon the app.</p>
<p><strong>The Critical Drop-Off Window</strong></p>
<p>We observed a steep drop in the survival probability curve between Month 3 and Month 6 across all acquisition channels. If a customer survives past Month 6, their probability of long-term retention increases exponentially.</p>
<p><strong>Channel Variance</strong></p>
<p>Customers acquired via specific marketing channels showed inherently different survival trajectories, suggesting that the quality of onboarding greatly impacts long-term loyalty.</p>
<section id="the-90-day-drop-off-survival-analysis" class="level3">
<h3 class="anchored" data-anchor-id="the-90-day-drop-off-survival-analysis">3.1 The 90-Day Drop-Off (Survival Analysis)</h3>
<ul>
<li><strong>The Finding:</strong> Our Kaplan-Meier Survival Curve pinpointed a critical ‚ÄúDanger Zone‚Äù between Month 3 and Month 6 of a customer‚Äôs tenure. The probability of survival plummets drastically during this 90-day window.</li>
<li><strong>The Insight:</strong> Users are downloading the app, trying it for a few months, and abandoning it if it doesn‚Äôt become their primary financial hub.</li>
<li><strong>Actionable Step:</strong> Marketing must deploy aggressive, targeted retention campaigns (e.g., fee waivers, premium account trials) exactly at the 60-day mark to preempt the Month 3 drop-off.</li>
</ul>
</section>
<section id="systemic-liquidity-sankey-network" class="level3">
<h3 class="anchored" data-anchor-id="systemic-liquidity-sankey-network">3.2 Systemic Liquidity (Sankey Network)</h3>
<ul>
<li><strong>The Finding:</strong> The Macro Cash Flow diagram mapped the exact dollar amounts flowing through the ecosystem. It visually proved that Direct Deposits are the absolute lifeblood of the platform, but a significant portion of that capital immediately flows out via External Withdrawals rather than staying in the app ecosystem (like Peer Transfers or App Investments).</li>
<li><strong>Actionable Step:</strong> Incentivize users to keep their money inside the FinRetain ecosystem by offering higher yield savings rates for capital that originates from Direct Deposits.</li>
</ul>
<hr>
</section>
</section>
<section id="macro-ecosystem-cash-flow-sankey" class="level2">
<h2 class="anchored" data-anchor-id="macro-ecosystem-cash-flow-sankey">4. Macro Ecosystem: Cash Flow Sankey</h2>
<p>The network analysis of capital flow mapped exactly how money enters and leaves the FinRetain ecosystem.</p>
<p><strong>Capital Retention:</strong> By balancing the visual nodes, we identified the exact proportion of incoming funds that are immediately drained via ‚ÄúExternal Withdrawals‚Äù versus funds that are kept within the ecosystem for ‚ÄúMerchant Payments‚Äù and ‚ÄúPeer Transfers.‚Äù</p>
<p><strong>Liquidity Insights:</strong> The thickest flow lines originate from external Deposits, proving that convincing a user to set up direct payroll deposit is the single most valuable action the app can incentivize.</p>
<hr>
</section>
<section id="proactive-intervention-predictive-modelling" class="level2">
<h2 class="anchored" data-anchor-id="proactive-intervention-predictive-modelling">5. Proactive Intervention (Predictive Modelling)</h2>
<p>The most significant achievement of the FinRetain project is the <strong>Risk Simulator</strong>. By integrating a Multiple Linear Regression model into our Shiny UI, we proved that churn is not inevitable. The model confirmed that <code>support_tickets_count</code> and <code>tx_count</code> are statistically significant predictors of <code>churn_probability</code>. Our multiple linear regression model confirmed that user behavior directly dictates future value.</p>
<ul>
<li><p><strong>Simulated Salvage:</strong> By interacting with the UI sliders, we proved that artificially lowering a user‚Äôs support ticket count and slightly increasing their transaction frequency drastically shifts their predicted Churn Probability from ‚ÄúHigh Risk‚Äù (Red) to ‚ÄúSafe‚Äù (Green), effectively saving their Customer Lifetime Value (CLV).</p></li>
<li><p><strong>The Result:</strong> Stakeholders can now use the dashboard sliders to simulate interventions. If a user has an 80% churn risk, the stakeholder can simulate lowering their support tickets (via faster customer service) and increasing their transaction frequency (via marketing pushes). The visual gauges update instantly, showing how the user‚Äôs Customer Lifetime Value (CLV) is salvaged.</p></li>
</ul>
<hr>
</section>
<section id="strategic-discussions-recommendations" class="level2">
<h2 class="anchored" data-anchor-id="strategic-discussions-recommendations">6. Strategic Discussions &amp; Recommendations</h2>
<p>Based on the quantitative results derived from the FinRetain platform, our team proposes the following strategic business interventions:</p>
<section id="a.-targeted-month-3-interventions" class="level3">
<h3 class="anchored" data-anchor-id="a.-targeted-month-3-interventions">A. Targeted ‚ÄúMonth 3‚Äù Interventions</h3>
<p>Since the Survival Analysis proved that Months 3 through 6 are the most dangerous for customer churn, the marketing team should automate targeted retention campaigns (e.g., fee waivers, premium feature trials) specifically triggered at the <strong>90-day tenure mark</strong>.</p>
</section>
<section id="b.-proactive-rfm-nurturing" class="level3">
<h3 class="anchored" data-anchor-id="b.-proactive-rfm-nurturing">B. Proactive RFM Nurturing</h3>
<p>The RFM Treemap highlighted a massive block of low-frequency ‚ÄúRecent Users.‚Äù We recommend using the insights from the <strong>Risk Simulator</strong> module to gamify the app experience (via daily login rewards or micro-investing features) to artificially inflate their transaction frequency and protect their projected CLV.</p>
</section>
<section id="c.-direct-deposit-incentivization" class="level3">
<h3 class="anchored" data-anchor-id="c.-direct-deposit-incentivization">C. Direct Deposit Incentivization</h3>
<p>The Sankey Cash Flow diagram proved that external Deposits feed the most capital into the app ecosystem. Business development should focus on campaigns that financially reward users for switching their primary salary deposit to FinRetain, as this ensures long-term liquidity.</p>
</section>
<section id="d.-frictionless-customer-support-for-high-value-users" class="level3">
<h3 class="anchored" data-anchor-id="d.-frictionless-customer-support-for-high-value-users">D. Frictionless Customer Support for High-Value Users</h3>
<p>Our CDA scatter plots proved that high-income users churn rapidly when dealing with poor customer support. We strongly recommend routing users identified as ‚ÄúChampions‚Äù by our RFM model to a priority, zero-wait-time customer service queue.</p>
<hr>
</section>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">7. Conclusion</h2>
<p>Data visualization is only valuable if it drives decisions. The FinRetain Visual Analytics platform successfully bridges the gap between raw data and executive decision-making. By leveraging R Shiny, <code>plotly</code>, <code>survival</code> models, <code>networkD3</code>, <code>survival</code> curves and <code>networkD3</code>, we have provided stakeholders with an interactive environment and exact insights needed to reduce churn, optimize capital flow, and maximize Customer Lifetime Value to not only view historical demographic data, but to actively simulate and predict future customer behavior.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "Óßã";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




<script src="site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>